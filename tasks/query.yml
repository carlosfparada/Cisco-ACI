---

- name: Query tenant configuration
  cisco.aci.aci_tenant: 
    host: "{{ ansible_host }}"
    username: "{{ ansible_user }}"
    password: "{{ ansible_ssh_pass }}"
    state: query
    validate_certs: "{{ aci_validate_certs }}"
  register: _tenants

- name: Debug Tenants
  debug:
    var: _tenants

- name: Query VRF configuration
  cisco.aci.aci_bd: 
    host: "{{ ansible_host }}"
    username: "{{ ansible_user }}"
    password: "{{ ansible_ssh_pass }}"
    vrf: "{{ item.key }}"
    tenant: "{{ item.value.tenant }}"
    state: "query"
    validate_certs: "{{ aci_validate_certs }}"
  loop: "{{ aci_vrfs | dict2items }}"
  register: _vrfs

- name: Debug VRFs
  debug:
    var: _vrfs

- name: Query BD configuration
  cisco.aci.aci_bd: 
    host: "{{ ansible_host }}"
    username: "{{ ansible_user }}"
    password: "{{ ansible_ssh_pass }}"
    bd: "{{ item.name }}"
    vrf: "{{ item.vrf }}"
    tenant: "{{ aci_vrfs[item.vrf]['tenant'] }}"
    state: "query"
    validate_certs: "{{ aci_validate_certs }}"
  loop: "{{ aci_bridgedomains }}"
  register: _bds

- name: Debug BDs
  debug:
    var: _bds
    
- name: Query l3
  cisco.aci.aci_l3out_interface:
    host: "{{ ansible_host }}"
    username: "{{ ansible_user }}"
    password: "{{ ansible_ssh_pass }}"
    tenant: "{{ aci_vrfs.vrf_b_1.tenant }}"
    # l3out: my_l3out
    # node_profile: my_node_profile
    # interface_profile: my_interface_profile
    pod_id: 1
    node_id: Node-101
    # path_ep: eth1/12
    state: query
  register: _l3

- name: Debug l3
  debug:
    var: _l3

# - name: Query all fabric interfaces
#   cisco.aci.aci_interface_config:
#     host: "{{ ansible_host }}"
#     username: "{{ ansible_user }}"
#     password: "{{ ansible_ssh_pass }}"
#     port_type: fabric
#     state: query
#   register: _interface

# - name: Debug interfaces
#   debug:
#     var: _interface